<!DOCTYPE html>
<header>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!--
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  -->
  <!-- Load d3.js -->
   <script src="./js/d3.v4.min.js" charset="utf-8"></script>
  <script src="./js/d3-queue.min.js"></script>
  <script src="./js/d3-chord.v0.0.min.js"></script>
</header>

<style>
.navlink-user{
  font-weight: bold;
}
</style>
<title>PAC2 Vistualització de dades</title>
<body>
  <nav class="navbar navbar-expand-md navbar-fixed-top navbar-light" role="navigation" role="navigation" style="background: #9aa698;">
      <div class="container">
            <a class="navbar-brand" href="#">PAC 2 Vistualització de dades</a>
            
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item active" id="navbar1">
                  <a class="nav-link" href="#section1">Bar chart <span class="sr-only"></span></a>
                </li>
              </ul>
              <ul class="navbar-nav">
                <li class="nav-item active" id="navbar2">
                  <a class="nav-link" href="#section2">Small multiple <span class="sr-only"></span></a>
                </li>
              </ul>
              <ul class="navbar-nav">
                <li class="nav-item active" id="navbar3">
                  <a class="nav-link" href="#section3">Chord diagram <span class="sr-only"></span></a>
                </li>
              </ul>
            </div>
          
        </div>
  </nav>
</body> 
  <div>

   
</div>
<div class="section one" id="section1">

<script>


  // set the dimensions and margins of the graph
  var margin1 = {top: 30, right: 30, bottom: 70, left: 60},
      width1 = 1000 - margin1.left - margin1.right,
      height1 = 1000 - margin1.top - margin1.bottom;

  // append the svg object to the body of the page
  var svg1 = d3.select("#section1")
    .append("svg")
      .attr("width", width1 + margin1.left + margin1.right)
      .attr("height", height1 + margin1.top + margin1.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin1.left + "," + margin1.top + ")");

  // Parse the Data
  d3.csv("./data/videojocs_simple.csv", function(data) {

  // X axis
  var x = d3.scaleBand()
    .range([ 0, width1 ])
    .domain(data.map(function(d) { return d.Platform; }))
    .padding(0.2);
  svg1.append("g")
    .attr("transform", "translate(0," + height1 + ")")
    .call(d3.axisBottom(x))
    .selectAll("text")
      .attr("transform", "translate(-10,0)rotate(-45)")
      .style("text-anchor", "end");

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 1300])
    .range([ height1, 0]);
  svg1.append("g")
    .call(d3.axisLeft(y));

  // Bars
  svg1.selectAll("mybar")
    .data(data)
    .enter()
    .append("rect")
      .attr("x", function(d) { return x(d.Platform); })
      .attr("y", function(d) { return y(d.Global_Sales); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height1 - y(d.Global_Sales); })
      .attr("fill", "#69b3a2")

  })

</script>
</div>
<div class="section two" id="section2">


  <script>

    // set the dimensions and margins of the graph
    var margin = {top: 30, right: 0, bottom: 30, left: 50},
        width = 250 - margin.left - margin.right,
        height = 210 - margin.top - margin.bottom;
    
    //Read the data
    d3.csv("./data/videojocs_full.csv", function(data) {
    
      // group the data: I want to draw one line per group
      var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
        .key(function(d) { return d.Platform;})
        .entries(data);

      // What is the list of groups?
      allKeys = sumstat.map(function(d){return d.key})
    
      // Add an svg element for each group. The will be one beside each other and will go on the next row when no more room available
      var svg = d3.select("#section2")
        .selectAll("uniqueChart")
        .data(sumstat)
        .enter()
        .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
    
      // Add X axis 
      var x = d3.scaleBand()
        .domain(d3.extent(data, function(d) { return d.Type_Sales; }))
        .range([ 0, width ]);
      svg
        .append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(3));
    
      //Add Y axis
      var y = d3.scaleLinear()
        .domain([0, d3.max(data, function(d) { return +d.Sales; })])
        .range([ height, 0 ]);
      svg.append("g")
        .call(d3.axisLeft(y).ticks(5));
    
      // color palette
      var color = d3.scaleOrdinal()
        .domain(allKeys)
        .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])
    
        // Draw the line
        svg.enter()
        .append("rect")
        .attr("fill", function(d){ return color(d.key) })
        .attr("stroke", "none")
        .append("rect")
          .attr("x", function(d) { return x(d.Type_Sales); })
          .attr("y", function(d) { return y(d.Sales); })
          .attr("width", x.bandwidth())
          .attr("height", function(d) { return height - y(d.Sales); })
          .attr("fill", "#69b3a2")




        .selectAll("mybar")
        .data(data)
        .enter()
        .append("rect")
          .attr("x", function(d) { return x(d.Type_Sales); })
          .attr("y", function(d) { return y(d.Sales); })
          .attr("width", x.bandwidth())
          .attr("height", function(d) { return height - y(d.Sales); })
          .attr("fill", "#69b3a2")
    
      // Add titles
      svg
        .append("text")
        .attr("text-anchor", "start")
        .attr("y", -5)
        .attr("x", 0)
        .text(function(d){ return(d.key)})
        .style("fill", function(d){ return color(d.key) })
    
    })
    </script>

</div>
<div class="section three" id="section3">
  <script>

var width3 = 720,
        height3 = 720,
        outerRadius3 = Math.min(width3, height3) / 2 - 10,
        innerRadius3 = outerRadius3 - 24;
    
    var formatPercent = d3.format(".1%");
    
    var arc = d3.arc()
        .innerRadius(innerRadius3)
        .outerRadius(outerRadius3);
    
    var path = d3.ribbon()
        .radius(innerRadius3);
    
    var chord_layout = d3.chord()
        .padAngle(0.01)
        .sortSubgroups(d3.descending)
        .sortGroups(d3.descending);    
    
    var svg3 = d3.select("#section3").append("svg")
        .attr("width", width3)
        .attr("height", height3)
        .append("g")
        .attr("id", "circle")
        .attr("transform", "translate(" + width3 / 2 + "," + height3 / 2 + ")");
    
    svg3.append("circle")
        .attr("r", outerRadius3);
    
    d3.queue()
        .defer(d3.json, "./data/pokemon.json")
        .await(ready);
    
    function ready(error, data) {
      if (error) throw error;
    
      var matrix = data.valuesData;
      var tipus = data.entities;
    
      var chord = chord_layout(matrix);
    
      var colorScale = d3.scaleOrdinal(d3.schemeCategory20b);
    
      // Añadimos una grupo por cada aeropuerto.
      var group = svg3.selectAll(".group")
          .data(chord.groups)
        .enter().append("g")
          .attr("class", "group")
          .on("mouseover", mouseover);
    
      // Añadimos un campo title que se mostrará automaticamente en el mouseover.
      group.append("title").text(function(d, i) {
        return tipus[i] + ": " + d.value + " pokemons";
      });
    
      // Es dibuixa cada grup com un arc
      var groupPath = group.append("path")
          .attr("id", function(d, i) { return "group" + i; })
          .attr("d", arc)
          .style("fill", function(d, i) { return colorScale(i); });
    
      // Y a cada arco le añadimos un nombre.
      var groupText = group.append("text")
          .attr("x", 6)
          .attr("dy", 15);
    
      groupText.append("textPath")
          .attr("xlink:href", function(d, i) { return "#group" + i; })
          .text(function(d, i) { return tipus[i]; });
    
      // Para cada par de valores ciudad1-ciudad2 y ciudad2-ciudad1 se dibuja una cuerda
      var chord = svg3.selectAll(".chord")
          .data(chord)
        .enter().append("path")
          .attr("class", "chord")
          .style("fill", function(d, i) { return colorScale(d.target.index); })
          .attr("d", path);
    
      // Añadimos un campo title como en el caso de los arcos pero algo más detellado
      chord.append("title").text(function(d) {
        return tipus[d.source.index]
            + " - " + tipus[d.target.index]
            + ": " + d.source.value;
      });
    
      function mouseover(d, i) {
        chord.classed("fade", function(p) {
          return p.source.index != i
              && p.target.index != i;
        });
      }
    }
    
    
    </script>
  
  <style>
   
    /* Specific Style */
    #circle circle {
      fill: none;
      pointer-events: all;
    }
    
    .group path {
      fill-opacity: .5;
    }
    
    path.chord {
      stroke: #000;
      stroke-width: .25px;
    }
    
    #circle:hover path.fade {
      display: none;
    }
    </style>
</div>

<script type="text/javascript">
  document.getElementById("navbar1").onclick = function() {
    document.getElementById("section2").style.display = "none";
    document.getElementById("section3").style.display = "none";
    document.getElementById("section1").style.display = "block";
  }

  document.getElementById("navbar2").onclick = function() {
    document.getElementById("section1").style.display = "none";
    document.getElementById("section3").style.display = "none";
    document.getElementById("section2").style.display = "block";
  }

  document.getElementById("navbar3").onclick = function() {
    document.getElementById("section1").style.display = "none";
    document.getElementById("section2").style.display = "none";
    document.getElementById("section3").style.display = "block";
  }
</script>